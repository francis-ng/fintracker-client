(this["webpackJsonpfinancial-tracker-client"]=this["webpackJsonpfinancial-tracker-client"]||[]).push([[0],{101:function(e,t,a){e.exports=a(112)},106:function(e,t,a){},109:function(e,t,a){},112:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),r=a(16),i=a.n(r),o=a(156),l=a(151),c=(a(106),a(107),a(30)),d=a(31),u=a(36),h=a(32),g=a(11),m=a(37),p=a(162),f=a(154),b=a(38),y=a(165),v=a(8),w=a(161),k=a(164),L=a(163),S=a(27),E=a(157),C=a(158);var O={getServerUrl:function(){return"https://fintrack-image-occpy2fuaa-an.a.run.app"},isReachable:function(){return fetch(this.getServerUrl(),{method:"HEAD",mode:"no-cors"}).then((function(e){return!0})).catch((function(e){return!1}))},login:function(e,t){var a=this.getServerUrl()+"/api/user/login";return fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({UserName:e,Password:t})}).then((function(e){return e.ok?e.json().then((function(e){return{success:!0,token:e.token}})):{success:!1}}))},register:function(e,t){var a=this.getServerUrl()+"/api/user/login";return fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({UserName:e,Password:t})}).then((function(e){return e.ok?{success:!0}:{success:!1}}))}};var T={getToken:function(){return localStorage.getItem("authToken")},saveToken:function(e){localStorage.setItem("authToken",e)}},I=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(h.a)(t).call(this,e))).showLogin=a.showLogin.bind(Object(g.a)(a)),a.showRegister=a.showRegister.bind(Object(g.a)(a)),a.handleInputChange=a.handleInputChange.bind(Object(g.a)(a)),a.handleLogin=a.handleLogin.bind(Object(g.a)(a)),a.handleRegister=a.handleRegister.bind(Object(g.a)(a)),a.verifyPassword=a.verifyPassword.bind(Object(g.a)(a)),a.loggedIn=a.props.completionCallback,a.state={showLogin:!0,showRegister:!1,showSpinner:!1,regSuccess:!1,regFailed:!1,loginFailed:!1,LoginUserName:"",LoginPassword:"",RegUserName:"",RegPassword:"",RegPasswordVerify:""},a}return Object(m.a)(t,e),Object(d.a)(t,[{key:"showLogin",value:function(){this.setState({showLogin:!0,showRegister:!1,regSuccess:!1,regFailed:!1,loginFailed:!1})}},{key:"showRegister",value:function(){this.setState({showLogin:!1,showRegister:!0,regSuccess:!1,regFailed:!1,loginFailed:!1})}},{key:"handleInputChange",value:function(e){var t=e.target.value,a=e.target.name;this.setState(Object(b.a)({},a,t))}},{key:"verifyPassword",value:function(e){return e===this.state.RegPassword?"":"Passwords do not match"}},{key:"handleLogin",value:function(e){var t=this;e.preventDefault(),this.setState({showSpinner:!0}),O.login(this.state.LoginUserName,this.state.LoginPassword).then((function(e){t.setState({showSpinner:!1}),e.success?(T.saveToken(e.token),t.setState({regSuccess:!1,loginFailed:!1}),t.loggedIn()):t.setState({regSuccess:!1,loginFailed:!0})}))}},{key:"handleRegister",value:function(e){var t=this;e.preventDefault(),this.state.RegPassword===this.state.RegPasswordVerify&&(this.setState({showSpinner:!0}),O.register(this.state.LoginUserName,this.state.LoginPassword).then((function(e){t.setState({showSpinner:!1}),e.success?t.setState({showLogin:!0,showRegister:!1,regSuccess:!0,regFailed:!1}):t.setState({regFailed:!0})})))}},{key:"render",value:function(){return s.a.createElement("div",null,this.state.showLogin&&s.a.createElement("form",{onSubmit:this.handleLogin},s.a.createElement(E.a,{tokens:{childrenGap:10},horizontalAlign:"center"},this.state.regSuccess&&s.a.createElement(y.a,{messageBarType:v.a.success,isMultiline:!1},"Registration successful"),this.state.loginFailed&&s.a.createElement(y.a,{messageBarType:v.a.error,isMultiline:!1},"The username and password do not match"),s.a.createElement(C.a,{label:"User name",name:"LoginUserName",value:this.state.LoginUserName,onChange:this.handleInputChange,required:!0}),s.a.createElement(C.a,{label:"Password",name:"LoginPassword",value:this.state.LoginPassword,onChange:this.handleInputChange,type:"password",required:!0}),s.a.createElement(E.a,{horizontal:!0,tokens:{childrenGap:10},verticalAlign:"center"},s.a.createElement(w.a,{text:"Login",type:"submit"}),this.state.showSpinner&&s.a.createElement(L.a,{size:S.a.small})),s.a.createElement(k.a,{onClick:this.showRegister},"Click here to register"))),this.state.showRegister&&s.a.createElement("form",{onSubmit:this.handleRegister},s.a.createElement(E.a,{tokens:{childrenGap:10},horizontalAlign:"center"},this.state.regFailed&&s.a.createElement(y.a,{messageBarType:v.a.error,isMultiline:!1},"The username and password do not match."),s.a.createElement(C.a,{label:"User name",name:"RegUserName",value:this.state.RegUserName,onChange:this.handleInputChange,required:!0}),s.a.createElement(C.a,{label:"Password",name:"RegPassword",type:"password",value:this.state.RegPassword,onChange:this.handleInputChange,required:!0}),s.a.createElement(C.a,{label:"Verify password",name:"RegPasswordVerify",type:"password",value:this.state.RegPasswordVerify,onChange:this.handleInputChange,onGetErrorMessage:this.verifyPassword,required:!0}),s.a.createElement(E.a,{horizontal:!0,tokens:{childrenGap:10},verticalAlign:"center"},s.a.createElement(w.a,{text:"Register",type:"submit"}),this.state.showSpinner&&s.a.createElement(L.a,{size:S.a.small})),s.a.createElement(k.a,{onClick:this.showLogin},"Return to login"))))}}]),t}(n.Component),j=a(152),H=a(153),N=a(169);var P={getServerUrl:function(){return"https://fintrack-image-occpy2fuaa-an.a.run.app"},listLedgers:function(e){var t=this.getServerUrl()+"/api/ledger/list",a=new Headers({Authorization:"Bearer "+e});return fetch(t,{headers:a}).then((function(e){return e.ok?e.json().then((function(e){return{success:!0,data:e}})):404===e.status?{success:!1,status:"Not found"}:401===e.status||403===e.status?{success:!1,status:"Unauthorized"}:{success:!1,status:"Error",data:[]}}))},getLedger:function(e,t,a){var n=this.getServerUrl()+"/api/ledger/get?year="+t+"&month="+a,s=new Headers({Authorization:"Bearer "+e});return fetch(n,{headers:s}).then((function(e){return e.ok?e.json().then((function(e){return{success:!0,data:e}})):401===e.status||403===e.status?{success:!1,status:"Unauthorized"}:404===e.status?{success:!1,status:"Not found"}:{success:!1,status:"Error",data:{Id:"",Owner:"",Type:"",Month:"",Year:"",Debits:[],DebitTotal:"",Credits:[],CreditTotal:""}}}))},addLedger:function(e,t){var a=this.getServerUrl()+"/api/ledger/add",n=new Headers({Authorization:"Bearer "+e,"Content-Type":"application/json"});return fetch(a,{method:"POST",headers:n,body:JSON.stringify(t)}).then((function(e){return e.ok?{success:!0}:401===e.status||403===e.status?{success:!1,status:"Unauthorized"}:{success:!1,status:"Error"}}))},updateLedger:function(e,t){var a=this.getServerUrl()+"/api/ledger/update?id="+t.Id,n=new Headers({Authorization:"Bearer "+e,"Content-Type":"application/json"});return fetch(a,{method:"PUT",headers:n,body:JSON.stringify(t)}).then((function(e){return e.ok?{success:!0}:401===e.status||403===e.status?{success:!1,status:"Unauthorized"}:{success:!1,status:"Error"}}))},deleteLedger:function(e,t){var a=this.getServerUrl()+"/api/ledger/delete?id="+t.Id,n=new Headers({Authorization:"Bearer "+e,"Content-Type":"application/json"});return fetch(a,{method:"DELETE",headers:n}).then((function(e){return e.ok?{success:!0}:401===e.status||403===e.status?{success:!1,status:"Unauthorized"}:{success:!1,status:"Error"}}))}},R=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(h.a)(t).call(this,e))).updateLedgerList=a.updateLedgerList.bind(Object(g.a)(a)),a.addLedger=a.addLedger.bind(Object(g.a)(a)),a.showFixed=a.showFixed.bind(Object(g.a)(a)),a.onChangeHandler=a.onChangeHandler.bind(Object(g.a)(a)),a.renderCell=a.renderCell.bind(Object(g.a)(a)),a.selectionHandler=a.props.selectHandler,a.loginHandler=a.props.loginHandler,a.months=["","January","February","March","April","May","June","July","August","September","October","November","December"],a.ledgers=[],a.commandItems=[{key:"new",text:"New item",iconProps:{iconName:"Add"},onClick:a.addLedger}],a.farItems=[{key:"fixed",text:"Fixed",iconProps:{iconName:"Calendar"},onClick:a.showFixed},{key:"refresh",text:"Refresh",ariaLabel:"Refresh",iconOnly:!0,iconProps:{iconName:"Refresh"},onClick:a.updateLedgerList}],a.state={dropdownOptions:[],displayedLedgers:[],showSpinner:!1},a}return Object(m.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){this.updateLedgerList()}},{key:"configureDropdown",value:function(){for(var e=[],t=0;t<this.ledgers.length;t++)-1===e.indexOf(this.ledgers[t].Year)&&e.push(parseInt(this.ledgers[t].Year));e.sort((function(e,t){return t-e}));for(var a=[],n=0;n<e.length;n++)a.push({key:e[n],text:e[n]});this.setState({dropdownOptions:a})}},{key:"updateLedgerList",value:function(){var e=this;this.setState({showSpinner:!0}),P.listLedgers(T.getToken()).then((function(t){e.setState({showSpinner:!1}),t.success?(e.ledgers=t.data,e.ledgers.sort(e.sortLedgers),e.setState({displayedLedgers:e.ledgers}),e.configureDropdown()):"Unauthorized"===t.status&&e.loginHandler()}))}},{key:"showFixed",value:function(){}},{key:"filterByYear",value:function(e){return this.ledgers.filter((function(t){return t.Year==e}))}},{key:"sortLedgers",value:function(e,t){return e.Year!==t.Year?t.Year-e.Year:t.Month-e.Month}},{key:"addLedger",value:function(){var e=new Date,t=e.getFullYear(),a=e.getMonth()+1;this.ledgers.length>0&&(t=parseInt(this.ledgers[0].Year),a=parseInt(this.ledgers[0].Month),13===++a&&(t++,a=1)),this.selectionHandler({target:{dataset:{year:t,month:a}}})}},{key:"onChangeHandler",value:function(e,t){this.setState({displayedLedgers:this.filterByYear(t.value).sort(this.sortLedgers)})}},{key:"renderCell",value:function(e,t){return s.a.createElement("div",{className:"list-item",onClick:this.selectionHandler,"data-year":e.Year,"data-month":e.Month},s.a.createElement(p.a,{"data-year":e.Year,"data-month":e.Month},"".concat(e.Year," ").concat(this.months[e.Month])))}},{key:"render",value:function(){return s.a.createElement("div",{"data-is-scrollable":"true"},s.a.createElement(E.a,null,s.a.createElement(H.a,{placeholder:"Filter by year",options:this.state.dropdownOptions,onChange:this.onChangeHandler}),s.a.createElement(j.a,{items:this.commandItems,farItems:this.farItems,ariaLabel:""}),this.state.showSpinner&&s.a.createElement(L.a,{size:S.a.medium}),s.a.createElement(N.a,{items:this.state.displayedLedgers,onRenderCell:this.renderCell})))}}]),t}(n.Component),U=a(44),A=a(160),D=a(87),M=a(150),x=a(22),F=a(6),z=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(h.a)(t).call(this,e))).save=a.save.bind(Object(g.a)(a)),a.addItem=a.addItem.bind(Object(g.a)(a)),a.handleTabClick=a.handleTabClick.bind(Object(g.a)(a)),a.renderItemColumn=a.renderItemColumn.bind(Object(g.a)(a)),a.onChangeHandler=a.onChangeHandler.bind(Object(g.a)(a)),a.loginHandler=a.props.loginHandler,a.backToList=a.props.returnHandler,a.parameters={year:a.props.selection.year,month:a.props.selection.month},a.newLedger=!1,a.displayprops={columns:[{key:"item",name:"Item",fieldName:"Label",isPadded:!0},{key:"amount",name:"Amount",fieldName:"Amount",isPadded:!0}],stackItemStyles:{root:{alignItems:"center",justifyContent:"right",display:"grid"}}},a.commandItems=[{key:"back",text:"Back",ariaLabel:"Back",iconOnly:!0,iconProps:{iconName:"Back"},onClick:a.backToList},{key:"new",text:"New item",iconProps:{iconName:"Add"},onClick:a.addItem}],a.farItems=[{key:"save",text:"Save",ariaLabel:"Save",iconOnly:!0,iconProps:{iconName:"CheckMark"},onClick:a.save}],a.state={ledger:{Type:"regular",Month:a.parameters.month,Year:a.parameters.year,Debits:[],DebitTotal:"",Credits:[],CreditTotal:""},selectedTab:"Debits",saveSuccess:!1,saveFailed:!1,dataLoaded:!1},a}return Object(m.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){this.getLedgerDetails()}},{key:"componentDidUpdate",value:function(e){this.props.selection.Year!==e.selection.Year&&this.props.selection.Month!==e.selection.Month&&this.getLedgerDetails()}},{key:"getLedgerDetails",value:function(){var e=this;console.log("Loading ".concat(this.parameters.year,"/").concat(this.parameters.month)),P.getLedger(T.getToken(),this.parameters.year,this.parameters.month).then((function(t){e.setState({dataLoaded:!0}),t.success?e.setState({ledger:t.data}):"Not found"===t.status?(console.log("No data found. New ledger will be created"),e.newLedger=!0):"Unauthorized"===t.status&&e.loginHandler()}))}},{key:"addItem",value:function(){var e=this;console.log("Adding new item to ".concat(this.state.selectedTab)),this.setState((function(t){return{ledger:Object(U.a)({},t.ledger,Object(b.a)({},e.state.selectedTab,t.ledger[e.state.selectedTab].concat({Label:"",Amount:""})))}}))}},{key:"save",value:function(){var e=this;this.setState({saveSuccess:!1,saveFailed:!1}),this.newLedger?P.addLedger(T.getToken(),this.state.ledger).then((function(t){t.success?e.setState({saveSuccess:!0}):e.setState({saveFailed:!0})})):P.updateLedger(T.getToken(),this.state.ledger).then((function(t){t.success?e.setState({saveSuccess:!0}):e.setState({saveFailed:!0})}))}},{key:"calculateTotal",value:function(e,t){return t.Amount?e+parseInt(t.Amount):e}},{key:"handleTabClick",value:function(e){this.setState({selectedTab:e.props.itemKey})}},{key:"onChangeHandler",value:function(e){var t=this,a=e.target.value,n=e.target.name,s=parseInt(e.target.dataset.index);console.log("Updating ".concat(n," of item ").concat(s," of ").concat(this.state.selectedTab)),this.setState((function(e){return{ledger:Object(U.a)({},e.ledger,Object(b.a)({},t.state.selectedTab,e.ledger[t.state.selectedTab].map((function(e,t){return t===s?Object(U.a)({},e,Object(b.a)({},n,a)):e}))))}}),(function(){"Debits"===t.state.selectedTab?t.setState((function(e){return{ledger:Object(U.a)({},e.ledger,{DebitTotal:e.ledger.Debits.reduce(t.calculateTotal,0)})}})):t.setState((function(e){return{ledger:Object(U.a)({},e.ledger,{CreditTotal:e.ledger.Credits.reduce(t.calculateTotal,0)})}}))}))}},{key:"renderItemColumn",value:function(e,t,a){switch(a.key){case"item":return s.a.createElement(C.a,{ariaLabel:"Item",name:"Label","data-index":t,value:this.state.ledger[this.state.selectedTab][t].Label,onChange:this.onChangeHandler});case"amount":return s.a.createElement(C.a,{ariaLabel:"Amount",name:"Amount",type:"number","data-index":t,value:this.state.ledger[this.state.selectedTab][t].Amount,onChange:this.onChangeHandler});default:return}}},{key:"render",value:function(){return s.a.createElement("div",null,this.state.saveSuccess&&s.a.createElement(y.a,{messageBarType:v.a.success,isMultiline:!1},"Saved"),this.state.saveFailed&&s.a.createElement(y.a,{messageBarType:v.a.error,isMultiline:!1},"Could not save. Please try again."),s.a.createElement(j.a,{items:this.commandItems,farItems:this.farItems,ariaLabel:""}),s.a.createElement(A.a,{selectedKey:this.state.selectedTab,onLinkClick:this.handleTabClick,styles:{link:{width:"50%"},linkIsSelected:{width:"50%"}}},s.a.createElement(D.a,{headerText:"Expenses",itemKey:"Debits"},s.a.createElement("div",{"data-is-scrollable":"true"},s.a.createElement(M.a,{items:this.state.ledger.Debits,columns:this.displayprops.columns,selectionMode:x.b.none,layoutMode:F.e.justified,isHeaderVisible:!0,enableShimmer:!this.state.dataLoaded,onRenderItemColumn:this.renderItemColumn}),s.a.createElement(E.a,{horizontal:!0,horizontalAlign:"end",tokens:{childrenGap:10,padding:32}},s.a.createElement(E.a.Item,{grow:5,styles:this.displayprops.stackItemStyles},"Total"),s.a.createElement(E.a.Item,{grow:!0,styles:this.displayprops.stackItemStyles},this.state.ledger.DebitTotal)))),s.a.createElement(D.a,{headerText:"Income",itemKey:"Credits"},s.a.createElement("div",{"data-is-scrollable":"true"},s.a.createElement(M.a,{items:this.state.ledger.Credits,columns:this.displayprops.columns,selectionMode:x.b.none,layoutMode:F.e.justified,isHeaderVisible:!0,enableShimmer:!this.state.dataLoaded,onRenderItemColumn:this.renderItemColumn}),s.a.createElement(E.a,{horizontal:!0,horizontalAlign:"end",tokens:{childrenGap:10,padding:32}},s.a.createElement(E.a.Item,{grow:5,styles:this.displayprops.stackItemStyles},"Total"),s.a.createElement(E.a.Item,{grow:!0,styles:this.displayprops.stackItemStyles},this.state.ledger.CreditTotal))))),s.a.createElement(E.a,{horizontal:!0,horizontalAlign:"end",tokens:{childrenGap:10,padding:32}},s.a.createElement(E.a.Item,{grow:5,styles:this.displayprops.stackItemStyles},s.a.createElement("b",null,"Net")),s.a.createElement(E.a.Item,{grow:!0,styles:this.displayprops.stackItemStyles},s.a.createElement("b",null,this.state.ledger.CreditTotal-this.state.ledger.DebitTotal))))}}]),t}(n.Component),Y=(a(109),function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(h.a)(t).call(this,e))).loginHandler=a.loginHandler.bind(Object(g.a)(a)),a.selectionHandler=a.selectionHandler.bind(Object(g.a)(a)),a.backToList=a.backToList.bind(Object(g.a)(a)),a.loggedIn=a.loggedIn.bind(Object(g.a)(a)),a.state={title:"Ledgers",showLedgerList:!0,showLedger:!1,showLogin:!1,selectedLedger:{year:"",month:""}},a.months=["","January","February","March","April","May","June","July","August","September","October","November","December"],a}return Object(m.a)(t,e),Object(d.a)(t,[{key:"loginHandler",value:function(){this.origin=this.state.title,this.setState({title:"Sign in",showLedgerList:!1,showLedger:!1,showLogin:!0})}},{key:"loggedIn",value:function(){"Ledgers"===this.origin?this.setState({title:"Ledgers",showLedgerList:!0,showLedger:!1,showLogin:!1}):this.setState({title:this.origin,showLedgerList:!1,showLedger:!0,showLogin:!1})}},{key:"selectionHandler",value:function(e){var t=e.target.dataset.year,a=e.target.dataset.month;this.setState({title:"".concat(t," ").concat(this.months[a])}),this.setState({selectedLedger:{year:t,month:a}}),this.setState({showLedgerList:!1,showLedger:!0,showLogin:!1})}},{key:"backToList",value:function(){this.setState({title:"Ledgers",showLedgerList:!0,showLedger:!1,showLogin:!1})}},{key:"render",value:function(){return s.a.createElement("div",{className:"ms-Grid",dir:"ltr"},s.a.createElement("div",{className:"ms-Grid-row header"},s.a.createElement("div",{className:"ms-Grid-col ms-sm12 align-center"},s.a.createElement(p.a,{variant:"large"},this.state.title))),s.a.createElement(f.a,{in:this.state.showLedgerList,timeout:200,classNames:"ledgerList",mountOnEnter:!0,unmountOnExit:!0},s.a.createElement(R,{selectHandler:this.selectionHandler,loginHandler:this.loginHandler})),s.a.createElement(f.a,{in:this.state.showLedger,timeout:200,classNames:"ledgerDetails",mountOnEnter:!0,unmountOnExit:!0},s.a.createElement(z,{selection:this.state.selectedLedger,loginHandler:this.loginHandler,returnHandler:this.backToList})),s.a.createElement(f.a,{in:this.state.showLogin,timeout:200,classNames:"authScreen",mountOnEnter:!0,unmountOnExit:!0},s.a.createElement(I,{completionCallback:this.loggedIn})))}}]),t}(n.Component)),B=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function J(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var a=e.installing;null!=a&&(a.onstatechange=function(){"installed"===a.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}Object(l.a)(),i.a.render(s.a.createElement(o.a,null,s.a.createElement(Y,null)),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/fintracker-client",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/fintracker-client","/workers/service-worker.js");B?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(a){var n=a.headers.get("content-type");404===a.status||null!=n&&-1===n.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):J(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):J(t,e)}))}}()}},[[101,1,2]]]);
//# sourceMappingURL=main.2b3e9fd1.chunk.js.map